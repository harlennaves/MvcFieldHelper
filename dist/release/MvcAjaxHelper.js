var Mvc;!function(e){!function(e){e.Date="DateFormatter"}(e.FieldFormatterType||(e.FieldFormatterType={}))}(Mvc||(Mvc={}));var Mvc;!function(e){var t=function(){return function(e){null!=e.type&&(this.type=e.type),null!=e.format&&(this.format=e.format)}}();e.FieldFormatModel=t}(Mvc||(Mvc={}));var Mvc;Mvc||(Mvc={});var Mvc;!function(e){!function(e){e.Input="InputFieldReader",e.CheckBox="CheckBoxFieldReader",e.Kendo="KendoFieldReader"}(e.FieldReaderType||(e.FieldReaderType={}))}(Mvc||(Mvc={}));var Mvc;!function(Mvc){var FieldPermission=function(){function FieldPermission(model){if(null==model)throw new Error("model cannot be null");if(null==model.role)throw new Error("role cannot be null");this.role=model.role,null==model.visibility&&(this.visibility="visible"),this.visibility=this.CheckVisibility(model.visibility),null!=model.action&&(this.action=eval(model.action))}return FieldPermission.prototype.CheckVisibility=function(e){switch(e){case"visible":return"visible";case"hidden":return"hidden";case"readonly":return"readonly";default:return"visible"}},FieldPermission.LoadPermissions=function(e){var t=new Array;try{t=JSON.parse(e)}catch(e){}return t},FieldPermission.setPropertyByPermission=function(e,t,r,o){if(null!=e&&null!=t&&""!=t&&null!=r&&0!=r.length){var l=$.grep(r,function(e){return e.role==t});if(1==l.length){var n=l[0];if(null!=n){switch(n.visibility){case"readonly":e.prop("readonly",!0);break;case"hidden":e.hide();break;case"visible":e.show()}null!=n.action&&n.action(e,o)}}}},FieldPermission}();Mvc.FieldPermission=FieldPermission}(Mvc||(Mvc={}));var Mvc;!function(e){var t=function(){return function(t){if(this.fieldId=t.fieldId,this.modelProperty=t.modelProperty,this.modelType=t.modelType,this.reader=t.reader,null==this.modelProperty)throw new Error("modelProperty cannot be null");null==this.fieldId&&(this.fieldId=this.modelProperty),null==this.modelType&&(this.modelType="string"),null==this.reader&&(this.reader=null==kendo||void 0==kendo.widgetInstance($("#"+this.fieldId),kendo.ui)?e.FieldReaderType.Input:e.FieldReaderType.Kendo),null!=t.formatter&&(this.formatter=new e.FieldFormatModel({type:t.formatter,format:t.format})),null!=t.readOnly&&(this.readOnly=t.readOnly),null!=t.group&&(this.group=t.group),null!=t.permissions&&(this.permissions=e.FieldPermission.LoadPermissions(t.permissions))}}();e.FieldMappingModel=t}(Mvc||(Mvc={}));var Mvc;Mvc||(Mvc={});var Mvc;!function(e){var t=function(){function e(){this.initializePath()}return e.prototype.initializePath=function(){var e=window.location.href.replace(window.location.origin,"");e.indexOf("#")>0&&(e=e.substring(0,e.indexOf("#"))),e.indexOf("?")>0&&(e=e.substring(0,e.indexOf("?")));var t=e.split("/");e==window.location.pathname&&t.length<=2?this.hostBasePath="/":t.length<2?this.hostBasePath="/":this.hostBasePath="/"+t[1]+"/"},e.prototype.post=function(e,t,r,o,l){var n=$('input[name="__RequestVerificationToken"]').val(),i=null==n||""==n?$.param(r):$.param($.extend({__RequestVerificationToken:n},r));$.ajax({type:"POST",dataType:"json",data:i,contentType:"application/x-www-form-urlencoded; charset=UTF-8",success:o,error:l,url:this.hostBasePath+e+"/"+t})},e.prototype.postJson=function(e,t,r,o,l){$.ajax({type:"POST",dataType:"json",data:JSON.stringify(r),contentType:"application/json; charset=utf-8",success:o,error:l,url:this.hostBasePath+e+"/"+t})},e}();e.HttpAjax=t}(Mvc||(Mvc={}));var Mvc;!function(Mvc){var FieldHelper=function(){function FieldHelper(e,t,r){this.Model=e,null==this.Model&&(this.Model={}),this.mapping=[],this.readers={},this.formatters={},this.group=t,this.role=r,this.initializeMapping(),this.http=new Mvc.HttpAjax}return FieldHelper.prototype.initializeMapping=function(){var e=null==this.group||""==this.group?$("[fh-Property]"):$("[fh-group='"+this.group+"']");if(null!=e&&0!=e.length)for(var t=0;t<e.length;t++){var r=e[t],o=r.attributes["fh-property"],l=r.attributes["fh-reader"],n=r.attributes["fh-formatter"],i=r.attributes["fh-format"],a=r.attributes["fh-readonly"],p=r.attributes["fh-group"],d=r.attributes["fh-permissions"];this.mapping.push(new Mvc.FieldMappingModel({fieldId:r.id,modelProperty:null==o?r.id:o.value,reader:null==l?null:Mvc.FieldReaderType[l.value],formatter:null==n?null:n.value,format:null==i?null:i.value,readOnly:null!=a&&a.value,group:null==p?null:p.value,permissions:null==d?null:d.value}))}},FieldHelper.prototype.getFieldReader=function(type){return null==this.readers[type.toString()]&&(this.readers[type.toString()]=eval("new Mvc."+type.toString()+"()")),this.readers[type.toString()]},FieldHelper.prototype.getFieldFormatter=function(format){if(null==format||null==format.type)return null;var typeName=format.type.toString();return null==this.formatters[typeName]&&(this.formatters[typeName]=eval("new Mvc."+Mvc.FieldFormatterType[typeName]+"()")),this.formatters[typeName]},FieldHelper.prototype.setRole=function(e){this.role=e},FieldHelper.prototype.setModel=function(e){for(var t=null==e||""==e?this.mapping:this.mapping.filter(function(t){return t.group==e}),r=t.length,o=0;o<r;o++){var l=t[o];l.readOnly||this.getFieldReader(l.reader).setModelValue(l,this.Model,this.getFieldFormatter(l.formatter))}},FieldHelper.prototype.getModel=function(e){for(var t=null==e||""==e?this.mapping:this.mapping.filter(function(t){return t.group==e}),r=t.length,o=0;o<r;o++){var l=t[o];this.getFieldReader(l.reader).getModelValue(l,this.Model,this.getFieldFormatter(l.formatter),this.role)}},FieldHelper.prototype.clearModel=function(e){for(var t=null==e||""==e?this.mapping:this.mapping.filter(function(t){return t.group==e}),r=t.length,o=0;o<r;o++){var l=t[o];this.Model[l.modelProperty]=""}this.getModel(e)},FieldHelper.prototype.post=function(e,t,r,o,l){this.setModel(r),this.http.post(e,t,this.Model,o,l)},FieldHelper}();Mvc.FieldHelper=FieldHelper}(Mvc||(Mvc={}));var Mvc;!function(e){var t=function(){function e(){this.defaultFormat="dd/mm/yyyy"}return e.prototype.getDate=function(e){if(-1!=e.indexOf("Date"))return new Date(parseFloat(/Date\(([^)]+)\)/.exec(e)[1]));if(-1!=e.indexOf("/")){var t=e.split("/");return new Date(parseInt(t[2]),parseInt(t[1])-1,parseInt(t[0]))}return null},e.prototype.getValue=function(e){return this.getDate(e)},e.prototype.format=function(e,t){if(null==e)return"";var r;return null!=(r=e instanceof Date?e:this.getDate(e.toString()))&&r instanceof Date?r.format(null==t?this.defaultFormat:t):""},e}();e.DateFormatter=t}(Mvc||(Mvc={}));var Mvc;!function(Mvc){var CheckBoxFieldReader=function(){function CheckBoxFieldReader(){this.getObjectValue=function(fullPropertyName,model){if(fullPropertyName.indexOf(".")<0)return model[fullPropertyName];for(var propertyParts=fullPropertyName.split("."),propertyEval="model",index=0;index<propertyParts.length;index++)if(propertyEval+="['"+propertyParts[index]+"']",index<propertyParts.length-1&&null==eval(propertyEval))return null;return eval(propertyEval)},this.setObjectValue=function(fullPropertyName,model,element){var objectValue=element.prop("checked");if(fullPropertyName.indexOf(".")<0)model[fullPropertyName]=objectValue;else{for(var propertyParts=fullPropertyName.split("."),propertyEval="model",index=0;index<propertyParts.length;index++)propertyEval+="['"+propertyParts[index]+"']",index<propertyParts.length-1&&null==eval(propertyEval)&&eval(propertyEval+" = {}");propertyEval+=" = "+("string"==typeof objectValue?"'"+objectValue+"'":objectValue),eval(propertyEval)}}}return CheckBoxFieldReader.prototype.getModelValue=function(e,t,r,o){var l=$("#"+e.fieldId);if(null!=l){Mvc.FieldPermission.setPropertyByPermission(l,o,e.permissions,t);var n=this.getObjectValue(e.modelProperty,t);null!=n&&l.prop("checked",n)}},CheckBoxFieldReader.prototype.setModelValue=function(e,t,r){var o=$("#"+e.fieldId);null!=o&&this.setObjectValue(e.modelProperty,t,o)},CheckBoxFieldReader}();Mvc.CheckBoxFieldReader=CheckBoxFieldReader}(Mvc||(Mvc={}));var Mvc;!function(Mvc){var InputFieldReader=function(){function InputFieldReader(){this.getObjectValue=function(fullPropertyName,model){if(fullPropertyName.indexOf(".")<0)return model[fullPropertyName];for(var propertyParts=fullPropertyName.split("."),propertyEval="model",index=0;index<propertyParts.length;index++)if(propertyEval+="['"+propertyParts[index]+"']",index<propertyParts.length-1&&null==eval(propertyEval))return null;return eval(propertyEval)},this.setObjectValue=function(fullPropertyName,model,element){var objectValue=element.val();if(fullPropertyName.indexOf(".")<0)model[fullPropertyName]=objectValue;else{for(var propertyParts=fullPropertyName.split("."),propertyEval="model",index=0;index<propertyParts.length;index++)propertyEval+="['"+propertyParts[index]+"']",index<propertyParts.length-1&&null==eval(propertyEval)&&eval(propertyEval+" = {}");propertyEval+=" = "+("string"==typeof objectValue?"'"+objectValue+"'":objectValue),eval(propertyEval)}}}return InputFieldReader.prototype.getModelValue=function(e,t,r,o){var l=$("#"+e.fieldId);if(null!=l){Mvc.FieldPermission.setPropertyByPermission(l,o,e.permissions,t);var n=this.getObjectValue(e.modelProperty,t);null!=n&&l.val(null==r?n:r.format(n,null==e.formatter?null:e.formatter.format))}},InputFieldReader.prototype.setModelValue=function(e,t,r){var o=$("#"+e.fieldId);null!=o&&this.setObjectValue(e.modelProperty,t,o)},InputFieldReader}();Mvc.InputFieldReader=InputFieldReader}(Mvc||(Mvc={}));var Mvc;!function(Mvc){var KendoFieldReader=function(){function KendoFieldReader(){var _this=this;this.getObjectValue=function(fullPropertyName,model){if(fullPropertyName.indexOf(".")<0)return model[fullPropertyName];for(var propertyParts=fullPropertyName.split("."),propertyEval="model",index=0;index<propertyParts.length;index++)if(propertyEval+="['"+propertyParts[index]+"']",index<propertyParts.length-1&&null==eval(propertyEval))return null;return eval(propertyEval)},this.setObjectValue=function(fullPropertyName,model,kendoElement){var objectValue=("kendoDatePicker"==_this.componentName||"kendoDateTimePicker"==_this.componentName)&&kendoElement.value()instanceof Date?kendoElement.value().toISOString():kendoElement.value();if(fullPropertyName.indexOf(".")<0)model[fullPropertyName]=objectValue;else{for(var propertyParts=fullPropertyName.split("."),propertyEval="model",index=0;index<propertyParts.length;index++)propertyEval+="['"+propertyParts[index]+"']",index<propertyParts.length-1&&null==eval(propertyEval)&&eval(propertyEval+" = {}");propertyEval+=" = "+("string"==typeof objectValue?"'"+objectValue+"'":objectValue),eval(propertyEval)}},this.componentName=null}return KendoFieldReader.prototype.setComponentName=function(e){if(null!=kendo)if(null!=e)if(void 0!=kendo.widgetInstance(e,kendo.ui)){switch(e.data("role")){case"autocomplete":this.componentName="kendoAutoComplete";break;case"datepicker":this.componentName="kendoDatePicker";break;case"datetimepicker":this.componentName="kendoDateTimePicker";break;case"combobox":this.componentName="kendoComboBox";break;case"dropdownlist":this.componentName="kendoDropDownList";break;case"maskedtextbox":this.componentName="kendoMaskedTextBox";break;case"numerictextbox":this.componentName="kendoNumericTextBox"}null!=this.componentName&&""!=this.componentName||(this.componentName="")}else this.componentName="";else this.componentName="";else this.componentName=""},KendoFieldReader.prototype.getModelValue=function(e,t,r,o){var l=$("#"+e.fieldId);if(null!=l){Mvc.FieldPermission.setPropertyByPermission(l,o,e.permissions,t),this.setComponentName(l);var n=l.data(this.componentName);if(null!=n){var i=this.getObjectValue(e.modelProperty,t);null!=r&&(i=r.format(i,null==e.formatter?null:e.formatter.format)),n.value(i)}}},KendoFieldReader.prototype.setModelValue=function(e,t,r){var o=$("#"+e.fieldId);if(null!=o){this.setComponentName(o);var l=o.data(this.componentName);null!=l&&this.setObjectValue(e.modelProperty,t,l)}},KendoFieldReader}();Mvc.KendoFieldReader=KendoFieldReader}(Mvc||(Mvc={}));